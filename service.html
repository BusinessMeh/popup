<!DOCTYPE html>
<html>
<head>
  <title>Custom ESC fullscreen handling</title>
</head>
<body>

<button id="btnFullscreen">Enter Fullscreen</button>
<p id="status">Not in fullscreen</p>

<script>
const btn = document.getElementById('btnFullscreen');
const status = document.getElementById('status');

let escHoldTimer = null;
let escHeldDuration = 0;
const escHoldThreshold = 10000; // 10 seconds

btn.addEventListener('click', () => {
  enterFullscreen();
});

function enterFullscreen() {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen()
      .then(() => {
        status.textContent = 'In fullscreen mode';
        startLogging();
      })
      .catch(err => console.error('Fullscreen error:', err));
  }
}

function startLogging() {
  console.log('Started locking screen...');
  // Add your repeating logic here if needed
}

function stopLogging() {
  console.log('Stopped locking screen...');
  // Clear intervals or repeated actions here if any
}

document.addEventListener('fullscreenchange', () => {
  if (!document.fullscreenElement) {
    status.textContent = 'Exited fullscreen';
    stopLogging();
  } else {
    status.textContent = 'In fullscreen mode';
    startLogging();
  }
});

// ESC key handling logic
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    if (e.ctrlKey) {
      // ESC + Ctrl pressed, allow exit by doing nothing
      console.log('ESC + Ctrl pressed: allow fullscreen exit');
      clearEscHold();
    } else {
      // ESC alone pressed: start hold timer
      if (!escHoldTimer) {
        console.log('ESC pressed, starting hold timer...');
        escHeldDuration = 0;
        escHoldTimer = setInterval(() => {
          escHeldDuration += 100;
          if (escHeldDuration >= escHoldThreshold) {
            console.log('ESC held for 10 seconds: allow fullscreen exit');
            clearEscHold();
            // Stop forcing fullscreen so user can exit now
          }
        }, 100);
      }
      // Immediately prevent fullscreen exit by forcing fullscreen again
      setTimeout(() => {
        if (document.fullscreenElement && escHeldDuration < escHoldThreshold) {
          console.log('Brief ESC press blocked: forcing fullscreen again');
          document.documentElement.requestFullscreen().catch(() => {});
        }
      }, 100);
    }
  }
});

document.addEventListener('keyup', (e) => {
  if (e.key === 'Escape') {
    if (escHeldDuration < escHoldThreshold) {
      // ESC released before 10 seconds â€” keep fullscreen by re-requesting
      console.log('ESC released before 10 seconds: re-enter fullscreen');
      document.documentElement.requestFullscreen().catch(() => {});
    }
    clearEscHold();
  }
});

function clearEscHold() {
  if (escHoldTimer) {
    clearInterval(escHoldTimer);
    escHoldTimer = null;
    escHeldDuration = 0;
  }
}
</script>

</body>
</html>
